# Copyright 2021 The Khronos Group
# SPDX-License-Identifier: Apache-2.0

## This file was generated by generate_device_frontend.py from CMakeLists.txt

set(CMAKE_CXX_STANDARD 11)

project(anari_library_tree LANGUAGES CXX)

if(CMAKE_VERSION VERSION_GREATER_EQUAL "3.12")
  find_package(Python3 REQUIRED COMPONENTS Interpreter)

  add_custom_target(generate_tree_queries
    COMMAND ${Python3_EXECUTABLE} ${ANARI_CODE_GEN_ROOT}/generate_queries.py
      --json ${ANARI_CODE_GEN_ROOT}
      --prefix Tree
      --device ${CMAKE_CURRENT_SOURCE_DIR}/tree_device.json
      --namespace anari_sdk::tree
      --output ${CMAKE_CURRENT_SOURCE_DIR}/generated
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    DEPENDS tree_device.json
  )

  add_dependencies(generate_all generate_tree_queries)

  add_custom_target(generate_tree_debug_objects
    COMMAND ${Python3_EXECUTABLE} ${ANARI_CODE_GEN_ROOT}/generate_debug_objects.py
      --json ${ANARI_CODE_GEN_ROOT}
      --device ${CMAKE_CURRENT_SOURCE_DIR}/tree_device.json
      --prefix Tree
      --namespace anari_sdk::tree
      --output ${CMAKE_CURRENT_SOURCE_DIR}/generated
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    DEPENDS tree_device.json
  )

  add_dependencies(generate_all generate_tree_debug_objects)

endif()

add_library(${PROJECT_NAME} SHARED
  src/TreeDevice.cpp
  src/TreeArrayObjects.cpp
  src/TreeFrameObject.cpp
  generated/TreeObjects.cpp
  generated/TreeDeviceFactories.cpp
  generated/TreeString.cpp
  generated/TreeQueries.cpp
  generated/TreeDebugFactory.cpp
)

target_include_directories(${PROJECT_NAME}
PUBLIC
  $<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIR}>
  src
  generated
)

target_link_libraries(${PROJECT_NAME}
PUBLIC
  anari::anari
  anari::anari_utilities
  anari::anari_library_debug
)

target_compile_definitions(${PROJECT_NAME}
PRIVATE
  "anari_library_tree_EXPORTS"
)

install(TARGETS ${PROJECT_NAME}
  LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
  RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
  ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
)
