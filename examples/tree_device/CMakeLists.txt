# Copyright 2021 The Khronos Group
# SPDX-License-Identifier: Apache-2.0

## This file was generated by generate_device_frontend.py from templates/CMakeLists.txt

set(CMAKE_CXX_STANDARD 11)

project(anari_library_tree LANGUAGES CXX)

if(CMAKE_VERSION VERSION_GREATER_EQUAL "3.12")
  find_package(Python3 REQUIRED COMPONENTS Interpreter)

  add_custom_target(generate_tree)

  add_custom_target(generate_tree_objects
    COMMAND ${Python3_EXECUTABLE} ${ANARI_JSON_PATH}/generate_debug_objects.py
      --json ${ANARI_JSON_PATH}
      --device ../../code_gen/devices/extended_device.json
      --prefix Tree
      --namespace tree
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    DEPENDS ../../code_gen/devices/extended_device.json
  )

  add_custom_target(generate_tree_queries
    COMMAND ${Python3_EXECUTABLE} ${ANARI_JSON_PATH}/generate_queries.py
      --json ${ANARI_JSON_PATH}
      --device ../../code_gen/devices/extended_device.json
      --prefix Tree
      --namespace tree
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
    DEPENDS ../../code_gen/devices/extended_device.json
  )

  add_dependencies(generate_tree
    generate_tree_objects
    generate_tree_queries)

  add_dependencies(generate_all generate_tree)
endif()

add_library(${PROJECT_NAME} SHARED
  TreeDevice.cpp
  TreeObjects.cpp
  TreeArrayObjects.cpp
  TreeFrameObject.cpp
  TreeDeviceFactories.cpp
  TreeString.cpp
  TreeQueries.cpp
  TreeDebugFactory.cpp
)

target_include_directories(${PROJECT_NAME}
PUBLIC
    $<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIR}>
)

target_link_libraries(${PROJECT_NAME}
PUBLIC
  anari
  anari_utilities
  anari_library_debug
)

install(TARGETS ${PROJECT_NAME}
  LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
  RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
  ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
)
